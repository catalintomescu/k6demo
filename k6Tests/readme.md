# k6

Performance testing for this project is done with [k6](https://k6.io).

## Parameters

Following parameters are supported:

| Name | Type | Description |
| ---- | ---- | ----------- |
| EXECUTION | String (Optional) | A string indicating which execution environment to be used `local` or `remote`. Default value is `local`. |
| OPTIONS_SET | String (Optional) | A string indicating which k6 options file to use. Default value is `load`. |
| TEST_FILTERS | String (Optional) | A string indicating that tests should be filtered. This is a pipe (`\|`) delimited value, first token being the `verb` (`startsWith`, `endsWith`, `contains`, `regex`) and the second token being the `value`. |
| USER_NAME, USER_PASSWORD | String (Optional) | The Okta user & password for getting a JWT token. This is only used for running tests in `remote` mode. |
| CLIENT_ID, CLIENT_SECRET, SCOPE | String (Optional) | The Okta client id & secret for getting a JWT token. This is only used for running tests in `remote` mode. |

## Testing locally

Running test against the API locally (http(s)://localhost:xxxx) is very simple, you just have to use the CLI commands to launch k6.

If you are testing an API with authentication the k6 scripts rely, by default, on the Swagger page auto-login script, the k6 JavaScript extension and an extra endpoint on the API called `token`.
The `token` endpoint is added only when running with `LocalDevelopment` environment variable and it allows the k6 scripts to get the token generated by the Swagger page.

## CLI Commands for Running k6

All tests are run from the `k6` folder.


- Using the `settings.json` file (mostly used when running tests on `localhost`)

  `k6 run main.js`

- With parameters from the command line (mostly used when running automated tests)

  `k6 run OPTIONS_SET="load" -e EXECUTION="local" -e USER_NAME="" -e USER_PASSWORD="" -e CLIENT_ID="" -e CLIENT_SECRET="" -e SCOPE="" main.js`

- Running tests against a remote server using secrets.json file for authentication

  `k6 run -e EXECUTION="remote" main.js`

- With New Relic integration

  `k6 run -e K6_STATSD_ENABLE_TAGS=true -e K6_STATSD_ADDR=671P-NRM001.maky.midam.farm:8125 -e OPTIONS_SET="load" -e EXECUTION="local" --out statsd main.js`
